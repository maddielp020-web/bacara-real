<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Mesa de BacarÃ¡ Cubano - FASE 4</title>
    <link rel="stylesheet" href="css/mesa.css">
</head>
<body>
    <div class="mesa-wrapper">
        <img src="img/mesa-fondo.png.jpg" alt="Mesa de BacarÃ¡" class="mesa-imagen">
        <div class="mesa-overlay" id="mesa-overlay">
            <!-- CAJÃ“N -->
            <div class="cajon-cartas" id="cajon-cartas">
                <div class="cartas-restantes" id="cartas-restantes">ğŸƒ 416 cartas</div>
                <div class="estado-barajando" id="estado-barajando">â™»ï¸ Barajando...</div>
            </div>

            <!-- CENTRAL -->
            <div class="area-central">
                <div class="mano-jugador" id="mano-corona">
                    <div class="icono-fijo corona">ğŸ‘‘</div>
                    <div class="carta-placeholder" id="carta1-corona">?</div>
                    <div class="carta-placeholder" id="carta2-corona">?</div>
                    <div class="puntuacion" id="puntuacion-corona">0</div>
                </div>
                <div class="mano-jugador" id="mano-retador">
                    <div class="icono-fijo retador">âš”ï¸</div>
                    <div class="carta-placeholder" id="carta1-retador">?</div>
                    <div class="carta-placeholder" id="carta2-retador">?</div>
                    <div class="puntuacion" id="puntuacion-retador">0</div>
                </div>
            </div>

            <!-- APUESTAS -->
            <div class="apuestas-zone">
                <button class="apostar-btn" onclick="apostar('corona', 100)">Apostar ğŸ‘‘</button>
                <button class="apostar-btn" onclick="apostar('retador', 100)">Apostar âš”ï¸</button>
            </div>

            <!-- ALERTAS -->
            <div class="comision-alert" id="comision-alert">-5% COMISIÃ“N</div>
        </div>
    </div>

    <!-- JS MÃ“DULOS -->
    <script src="js/mesa-cartas.js"></script>
    <script src="js/mesa-apuestas.js"></script>
    <script src="js/mesa-historial.js"></script>
    <script src="js/mesa-duelo.js"></script>
    <script src="js/mesa-ui.js"></script>
       
    <script>
        // ğŸ”§ Fixes crÃ­ticos primero
        window.mesaCartas = window.mesaCartas || { 
            nuevaMano: () => {}, 
            obtenerEstado: () => ({}), 
            obtenerColorPalo: (p) => '#000' 
        };
        window.mesaApuestas = window.mesaApuestas || { 
            procesarResultado: (w) => {}, 
            apostar: (d,c) => {} 
        };
        window.mesaDuelo = window.mesaDuelo || { 
            obtenerEstadoDuelo: () => ({coronaActual: 'leon', retadorActual: 'dragon'}),
            iniciarDueloInicial: () => {}
        };
        window.procesarResultado = window.procesarResultado || ((w) => {});
        window.actualizarUICompleta = window.actualizarUICompleta || (() => {});

        // ğŸ¾ FUNCIÃ“N crearJugadores() RESTAURADA
        function crearJugadores() {
            const overlay = document.getElementById('mesa-overlay');
            const jugadores = [
                {clase: 'jugador-leon', id: 'leon', avatar: 'ğŸ¦', nombre: 'LeÃ³n'},
                {clase: 'jugador-dragon', id: 'dragon', avatar: 'ğŸ‰', nombre: 'DragÃ³n'},
                {clase: 'jugador-conejo', id: 'conejo', avatar: 'ğŸ°', nombre: 'Conejo'},
                {clase: 'jugador-aguila', id: 'aguila', avatar: 'ğŸ¦…', nombre: 'Ãguila'},
                {clase: 'jugador-cobra', id: 'cobra', avatar: 'ğŸ', nombre: 'Cobra'},
                {clase: 'jugador-buho', id: 'buho', avatar: 'ğŸ¦‰', nombre: 'BÃºho'}
            ];
            
            jugadores.forEach(j => {
                const div = document.createElement('div');
                div.className = `jugador ${j.clase}`;
                div.innerHTML = `
                    <span class="corona-badge" id="corona-${j.id}">ğŸ‘‘ CORONA</span>
                    <span class="retador-badge" id="retador-${j.id}">âš”ï¸ RETADOR</span>
                    <span class="jugador-avatar">${j.avatar}</span>
                    <div class="jugador-nombre">${j.nombre}</div>
                    <div class="jugador-fichas">
                        <span class="ficha-casino">ğŸª™</span>
                        <span class="fichas-numero" data-jugador="${j.id}">1,250</span>
                    </div>
                `;
                overlay.appendChild(div);
            });
        }

        // ğŸ® FUNCIÃ“N simularPartida() RESTAURADA
        function simularPartida() {
            setInterval(() => {
                if (window.mesaCartas) window.mesaCartas.nuevaMano();
                if (window.mesaApuestas) {
                    const ganador = Math.random() > 0.5 ? 'corona' : 'retador';
                    window.procesarResultado(ganador);
                    if (window.mesaUI && window.mesaUI.mostrarReaccionesPorMano) {
                        window.mesaUI.mostrarReaccionesPorMano(ganador);
                    }
                }
                window.actualizarUICompleta();
            }, 5000);
        }

        // ğŸ’° FUNCIÃ“N apostar() RESTAURADA
        function apostar(destino, cantidad) {
            window.apostar(destino, cantidad);
        }

        // ğŸš€ INICIALIZAR (espera 100ms que todos los JS carguen)
        window.addEventListener('load', function() {
            setTimeout(() => {
                crearJugadores();
                window.mesaDuelo?.iniciarDueloInicial?.('leon', 'aguila');
                simularPartida();
                console.log('ğŸ® FASE 4 COMPLETA âœ… - Todos los animales restaurados');
            }, 100);
        });
    </script>
</body>
</html>
