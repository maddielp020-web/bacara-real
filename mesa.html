<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Mesa de Bacar√° Cubano - FASE 4</title>
    <link rel="stylesheet" href="css/mesa.css">
</head>
<body>
    <div class="mesa-wrapper">
        <img src="img/mesa-fondo.png.jpg" alt="Mesa de Bacar√°" class="mesa-imagen">
        <div class="mesa-overlay" id="mesa-overlay">

            <!-- APUESTAS -->
            <div class="apuestas-zone">
                <button class="apostar-btn" onclick="apostar('corona', 100)">Apostar üëë</button>
                <button class="apostar-btn" onclick="apostar('retador', 100)">Apostar ‚öîÔ∏è</button>
            </div>

            <!-- ALERTAS -->
            <div class="comision-alert" id="comision-alert">-5% COMISI√ìN</div>
        </div>
    </div>

        <!-- JS M√ìDULOS - ORDEN CR√çTICO -->
    <script src="js/mesa-orquestador.js"></script>
    <script src="js/mesa-cartas.js"></script>
    <script src="js/mesa-apuestas.js"></script>
    <script src="js/mesa-duelo.js"></script>
    <script src="js/mesa-ui.js"></script>
    <script src="js/mesa-historial.js"></script>
<script>

    // üêæ 1. FUNCI√ìN crearJugadores() ORIGINAL - SIN CAMBIOS
    function crearJugadores() {
        const overlay = document.getElementById('mesa-overlay');
        const jugadores = [
            {clase: 'jugador-leon', id: 'leon', avatar: 'ü¶Å', nombre: 'Le√≥n'},
            {clase: 'jugador-dragon', id: 'dragon', avatar: 'üêâ', nombre: 'Drag√≥n'},
            {clase: 'jugador-conejo', id: 'conejo', avatar: 'üê∞', nombre: 'Conejo'},
            {clase: 'jugador-aguila', id: 'aguila', avatar: 'ü¶Ö', nombre: '√Åguila'},
            {clase: 'jugador-cobra', id: 'cobra', avatar: 'üêç', nombre: 'Cobra'},
            {clase: 'jugador-buho', id: 'buho', avatar: 'ü¶â', nombre: 'B√∫ho'}
        ];
        
        jugadores.forEach(j => {
            const div = document.createElement('div');
            div.className = `jugador ${j.clase}`;
            div.innerHTML = `
                <span class="corona-badge" id="corona-${j.id}" style="display: none;">üëë CORONA</span>
                <span class="retador-badge" id="retador-${j.id}" style="display: none;">‚öîÔ∏è RETADOR</span>
                <span class="jugador-avatar">${j.avatar}</span>
                <div class="jugador-nombre">${j.nombre}</div>
                <div class="jugador-fichas">
                    <span class="ficha-casino">ü™ô</span>
                    <span class="fichas-numero" data-jugador="${j.id}">1,250</span>
                </div>
            `;
            overlay.appendChild(div);
        });
        console.log('‚úÖ 6 animales/jugadores CREADOS correctamente');
    }

    // üí∞ 2. FUNCI√ìN apostar() - Wrapper simple
    function apostar(destino, cantidad) {
        if (window.apostar) {
            window.apostar(destino, cantidad);
            console.log(`üí∞ Apuesta: ${cantidad} fichas a ${destino.toUpperCase()}`);
        } else {
            console.log(`‚ö†Ô∏è Sistema apuestas no cargado - apostando simuladamente a ${destino}`);
        }
    }

    // üéÆ 3. SIMULADOR con Orquestador Central
    function simularPartida() {
        console.log('üöÄ SIMULADOR 7s ACTIVADO - Juego autom√°tico iniciado');
        setInterval(() => {
            if (window.nuevaManoCompleta) {
                window.nuevaManoCompleta();
            }
        }, 7000);
    }

    // üöÄ 4. INICIALIZACI√ìN SECUENCIAL (200ms espera total)
    window.addEventListener('load', function() {
        setTimeout(() => {
            console.log('üéÆ === INICIALIZANDO MESA BACAR√Å CUBANO ===');
            
            // PASO 1: Crear jugadores (animales)
            crearJugadores();
             restaurarIconosFijos();

            // üî• FUNCI√ìN AISLADA: Solo √≠conos fijos
function restaurarIconosFijos() {
    // Icono üëë Corona (izquierda)
    const manoCorona = document.getElementById('mano-corona');
    if (manoCorona && !manoCorona.querySelector('.icono-fijo.corona')) {
        const iconoCorona = document.createElement('div');
        iconoCorona.className = 'icono-fijo corona';
        iconoCorona.textContent = 'üëë';
        manoCorona.insertBefore(iconoCorona, manoCorona.firstChild);
    }
    
    // Icono ‚öîÔ∏è Retador (derecha) 
    const manoRetador = document.getElementById('mano-retador');
    if (manoRetador && !manoRetador.querySelector('.icono-fijo.retador')) {
        const iconoRetador = document.createElement('div');
        iconoRetador.className = 'icono-fijo retador';
        iconoRetador.textContent = '‚öîÔ∏è';
        manoRetador.insertBefore(iconoRetador, manoRetador.firstChild);
    }
    
    console.log('‚úÖ Iconos fijos üëë‚öîÔ∏è restaurados en ventanas');
}
            
            // PASO 2: Fix colores cartas (rojo ‚ô•‚ô¶)
            if (window.mesaOrquestador && window.mesaOrquestador.fixColoresCartas) {
                window.mesaOrquestador.fixColoresCartas();
                console.log('‚úÖ Colores cartas corregidos (rojo ‚ô•‚ô¶, blanco ‚ô†‚ô£)');
            }
            
            // PASO 3: Orquestador central
            if (window.mesaOrquestador && window.mesaOrquestador.inicializar) {
                window.mesaOrquestador.inicializar();
                console.log('‚úÖ Orquestador central inicializado');
            }
            
            // PASO 4: Duelo inicial
            if (window.mesaDuelo && window.mesaDuelo.iniciarDueloInicial) {
                window.mesaDuelo.iniciarDueloInicial('leon', 'aguila');
                console.log('‚úÖ Duelo inicial: Le√≥n üëë vs √Åguila ‚öîÔ∏è');
            }
            
            // PASO 5: Simulador autom√°tico
            simularPartida();
            
            console.log('üéØ ‚úÖ MESA BACAR√Å CUBANO - FASE 4.1 COMPLETA');
            console.log('‚úÖ 6 animales visibles');
            console.log('‚úÖ Rotaci√≥n duelo activa');
            console.log('‚úÖ Comisi√≥n 5% lista');
            console.log('‚úÖ Emojis reacci√≥n listos');
            console.log('‚úÖ Juego avanza cada 7 segundos');
        }, 200);
    });
</script>
</body>
</html>
